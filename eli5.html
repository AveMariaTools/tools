<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ELI5 Knowledge Mapper</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f0f8ff; color: #333; }
  header { background: #1e90ff; color: white; padding: 1rem; text-align: center; }
  header h1 { margin: 0; }
  main { padding: 1rem; max-width: 1000px; margin: auto; }
  input, button { padding: 0.5rem; font-size: 1rem; }
  #conceptInput { width: 70%; border-radius: 4px; border: 1px solid #ccc; }
  #generateBtn { background: #1e90ff; color: white; border: none; cursor: pointer; border-radius: 4px; margin-left: 0.5rem; }
  #generateBtn:hover { background: #0c60b2; }
  #mapContainer { margin-top: 2rem; display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; }
  .node { background: #87cefa; padding: 1rem; border-radius: 8px; min-width: 180px; max-width: 250px; flex: 1; box-shadow: 2px 2px 6px rgba(0,0,0,0.1); }
  .node strong { display: block; margin-bottom: 0.5rem; }
  @media(max-width:600px) {
    #conceptInput { width: 100%; margin-bottom: 0.5rem; }
    #generateBtn { width: 100%; margin-left: 0; }
    #mapContainer { flex-direction: column; align-items: center; }
  }
</style>
</head>
<body>

<header>
  <h1>ELI5 Knowledge Mapper</h1>
  <p>Type a concept and get a simple explanation with sub-topics!</p>
</header>

<main>
  <div style="display:flex; flex-wrap: wrap; gap:0.5rem;">
    <input type="text" id="conceptInput" placeholder="Enter a concept...">
    <button id="generateBtn">Generate Map</button>
  </div>

  <div id="mapContainer"></div>
</main>

<script>
const mapContainer = document.getElementById('mapContainer');
const input = document.getElementById('conceptInput');
const button = document.getElementById('generateBtn');

button.addEventListener('click', async () => {
  const concept = input.value.trim();
  if (!concept) return alert('Please enter a concept!');

  mapContainer.innerHTML = '<p>Loading...</p>';

  try {
    const response = await fetch('https://groqproxy.nicholaskarlek.workers.dev/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'groq-1',
        messages: [
          {
            role: 'user',
            content: `Explain "${concept}" like I'm five, and give 3 simple subtopics or analogies as a list. Return JSON with "explanation" and "subtopics".`
          }
        ]
      })
    });

    const data = await response.json();

    // The Worker might return Groq API format: we need to extract content
    let messageContent = '';
    if (data.choices && data.choices[0]?.message?.content) {
      messageContent = data.choices[0].message.content;
    } else {
      messageContent = JSON.stringify(data); // fallback
    }

    let parsed = { explanation: concept, subtopics: [] };
    try {
      parsed = JSON.parse(messageContent);
    } catch(e) {
      // fallback: simple split
      parsed = {
        explanation: messageContent,
        subtopics: ['Subtopic 1', 'Subtopic 2', 'Subtopic 3']
      };
    }

    renderMap(parsed);
  } catch (err) {
    console.error(err);
    const fallbackData = {
      explanation: `Imagine "${concept}" as something simple and easy to understand.`,
      subtopics: ['Sub-concept 1', 'Sub-concept 2', 'Sub-concept 3']
    };
    renderMap(fallbackData);
  }
});

function renderMap(data) {
  mapContainer.innerHTML = '';
  
  const mainNode = document.createElement('div');
  mainNode.className = 'node';
  mainNode.innerHTML = `<strong>Main Concept:</strong>${data.explanation}`;
  mapContainer.appendChild(mainNode);

  data.subtopics.forEach(sub => {
    const node = document.createElement('div');
    node.className = 'node';
    node.innerHTML = `<strong>Sub-topic:</strong>${sub}`;
    mapContainer.appendChild(node);
  });
}
</script>

</body>
</html>
